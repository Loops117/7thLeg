<style id="profile-modern-theme">
  .card {
    border: 1px solid rgba(0, 0, 0, .06);
    border-radius: 14px;
    box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .03);
    overflow: hidden;
  }

  .card-header {
    background: linear-gradient(180deg, #ffffff, #f8f9fa);
    border-bottom: 1px solid rgba(0, 0, 0, .06);
    font-weight: 700;
    color: #198754;
  }

  .list-group-item {
    border-color: rgba(0, 0, 0, .06);
  }

  #profile-analytics .stat-tile {
    background: linear-gradient(180deg, rgba(248, 249, 250, 0.9), rgba(255, 255, 255, 0.9));
    border: 1px solid rgba(0, 0, 0, 0.06);
  }

  #profile-analytics .viz-card {
    background: #fff;
    border: 1px solid rgba(0, 0, 0, 0.06);
  }

  #profile-analytics .label {
    color: #6c757d;
    font-size: .85rem;
  }

  #profile-analytics .value {
    font-size: clamp(1.4rem, 3.5vw, 2rem);
    font-weight: 800;
    line-height: 1.1;
  }
</style>

<div class="mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <h3 class="fw-bold" id="profile-name">
      Loading...
    </h3>
    <form class="d-flex" id="profile-search-form" style="max-width: 280px;">
      <input class="form-control me-2" id="profile-search" placeholder="Search users" type="text" />
      <button class="btn btn-sm btn-primary" type="submit">
        Search
      </button>
    </form>
    <ul class="list-group position-absolute w-100 mt-1" id="search-dropdown" style="z-index:1000; display: none;">
    </ul>
    <button class="btn btn-outline-secondary btn-sm ms-3" id="my-profile-btn" style="display: none;" type="button">
      My Profile
    </button>
  </div>
  <p class="text-muted" id="profile-role">
  </p>
</div>

<!-- Combined Badges, Rating + Analytics -->
<div class="card mb-4 border-0 shadow-sm rounded-4" id="profile-analytics">
  <div class="card-body p-3 p-md-4">

    <!-- badges + rating row -->
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
      <div class="d-flex gap-2 flex-wrap" id="profile-badges">
        Loading badges...
      </div>
      <div class="fs-5 text-warning" id="profile-rating">
        ⭐ No reviews yet
      </div>
    </div>

    <!-- analytics row -->
    <div class="row g-3 align-items-stretch">
      <div class="col-6 col-md-3">
        <div class="stat-tile rounded-3 p-3">
          <div class="label">Species Tracked</div>
          <div class="value" id="profile-stats-total">—</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-tile rounded-3 p-3">
          <div class="label">Unique Species</div>
          <div class="value" id="profile-stats-unique">—</div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="viz-card rounded-3 p-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="label mb-0">By Invert Type</div>
            <div class="small" id="profile-stats-legend"></div>
          </div>
          <canvas id="profile-type-pie" height="20"></canvas>
        </div>
      </div>
      <div class="col-12">
        <div class="viz-card rounded-3 p-3">
          <div class="label mb-2">Counts</div>
          <div id="profile-stats-types" class="d-flex flex-wrap gap-2"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- About Me -->
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header bg-primary text-black">
    About Me
  </div>
  <div class="card-body">
    <p id="profile-about">
      Loading...
    </p>
  </div>
</div>


<!-- Reviews + Bulletins -->
<div class="row">
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-primary text-black">
        Reviews
      </div>
      <div class="card-body">
        <div id="profile-reviews" style="max-height:300px; overflow-y:auto;">
          Loading reviews...
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-primary text-black">
        Recent Bulletins
      </div>
      <div class="card-body">
        <div id="profile-bulletins" style="max-height:300px; overflow-y:auto;">
          Loading bulletins...
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Inventory & Wishlist -->
<div class="row">
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-primary text-black">
        Inventory
      </div>
      <div class="card-body" id="profile-inventory" style="max-height:600px; overflow-y:auto;">
        Loading inventory...
      </div>
    </div>
  </div>
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-primary text-black">
        Wishlist
      </div>
      <div class="card-body" id="profile-wishlist" style="max-height:600px; overflow-y:auto;">
        Loading wishlist...
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>